<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head><link rel="stylesheet" type="text/css" href="description/Combined.css,0:sprite;/Areas/Epx/Themes/Windows/Content:0&amp;amp;hashKey=15EDE1F25211E852032D2691D5FEB7B8" xmlns="http://www.w3.org/1999/xhtml" />
<link rel="stylesheet" type="text/css" href="description/c9b486a1-0011-4088-b424-6fe1108f4cf6Combined.css,0:sprite,1:LinkList;/Areas/Epx/Themes/Windows/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=52ADCBE5376E50AE6798D3D038D063E9" xmlns="http://www.w3.org/1999/xhtml" />

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>Tracedrv</title>
        <link href="description/Galleries.css" type="text/css" rel="Stylesheet" /><link href="description/Layout.css" type="text/css" rel="Stylesheet" /><link href="description/Brand.css" type="text/css" rel="Stylesheet" /><link href="description/ad2ea103-5cd9-4fe1-8102-a381d94d6535Brand.css" type="text/css" rel="Stylesheet" />
        <link href="description/iframedescription.css" rel="Stylesheet" type="text/css" />
        <script src="description/offline.js" type="text/javascript"></script>
        <style type="text/css">
            #projectInfo {
                overflow: auto;
            }
            #longDesc {
                clear:both;
                margin: 25px 0 10px 0;
            }

            #SampleIndexList{
                margin-left: 15px;
            }
        </style>
    </head>
<body>
    <div id="offlineDescription">
        <h1>Tracedrv</h1>
        <br/>
        <div id="projectInfo">
            <div class="section">
                    <div class="itemBarLong tagsContainer">
                        <label for="Technologies">Technologies</label>
                        <div id="Technologies">
                            WDM, Windows Driver
                        </div>
                    </div>
                    <div class="itemBarLong tagsContainer">
                        <label for="Topics">Topics</label>
                        <div id="Topics">
                            general
                        </div>
                    </div>
                <div class="itemBarLong">
                    <label for="Platforms">Platforms</label>
                    <div id="Platforms">
                        Desktop
                    </div>
                </div>
                <div class="itemBarLong">
                    <label for="Requirements">Requirements</label>
                    <div id="Requirements">
                        
                    </div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Primary language</label>
                    <div id="LastUpdated">en-US</div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Updated</label>
                    <div id="LastUpdated">10/17/2013</div>
                </div>
                <div class="itemBarLong">
                    <label for="License">License</label>
                    <div id="License">
                        <a href="license.rtf">MS-LPL</a></div>
                </div>
                <div class="itemBar">
                    <div class="viewonlinecont">
                        <a data-link="online" href="http://code.msdn.microsoft.com/windowshardware/Tracedrv-f1c8ada8">View this sample online</a>
                    </div>
                </div>
            </div>
        </div>
        
                   
<script type="text/javascript">
    function initializePage() {
        var otherTabClass = 'otherTab';
        var hiddenPreClass = 'hidden';

        var htmlDecode = function(encodedData) {
            var decodedData = "";
            if (encodedData) {
                var div = document.createElement('div');
                div.innerHTML = encodedData;
                decodedData = div.firstChild.nodeValue.replace( /\\r\\n/ig , '\r\n');
            }
            return decodedData;
        };
                
        Galleries.iterateElem(Galleries.findElem(null, 'div', 'scriptcode'), function (index, scriptBlock) {
            var titleElem = Galleries.findElem(scriptBlock, 'div', 'title')[0];
            var labelElems = Galleries.findElem(titleElem, 'span');
            if (labelElems.length == 0) {
                labelElems = titleElem;
            }
            var languageSpans = Galleries.findElem(scriptBlock, 'span', 'hidden');
            var pres = Galleries.findElem(scriptBlock, 'pre');
            if (languageSpans.length > 0 && pres.length > 1) {
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    var languageSpan = languageSpans[index];
                            
                    elem.code = codePre.innerHTML.replace( /(\r(\n)?)|((\r)?\n)/ig , '\\r\\n');
                            
                    codePre.className = codePre.className.replace(hiddenPreClass, '');
                            
                    languageSpan.parentNode.removeChild(languageSpan);
                });

                pres = Galleries.findElem(scriptBlock, 'pre');
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    if (index == 0) {
                        scriptBlock.activeTab = 0;
                    }
                    else {
                        labelSpan.className += otherTabClass;
                        codePre.className += hiddenPreClass;
                    }
                    Galleries.attachEventHandler(labelSpan, 'click', function(e) {
                        var activeTab = scriptBlock.activeTab;
                        labelElems[activeTab].className += otherTabClass;
                        pres[activeTab].className += hiddenPreClass;

                        codePre.className = codePre.className.replace(hiddenPreClass, '');
                        labelSpan.className = labelSpan.className.replace(otherTabClass, '');
                        scriptBlock.activeTab = index;
                    });
                });

                var preview = Galleries.findElem(scriptBlock, 'div', 'preview');
                if (preview.length == 0) {
                    preview.push(pres[pres.length - 1]);
                }
                Galleries.iterateElem(preview, function(index, elem) {
                    elem.parentNode.removeChild(elem);
                });

                if (window.clipboardData && clipboardData.setData) {
                    var copyLink = document.createElement('a');
                    copyLink.href = 'javascript:void(0);';
                    copyLink.className = 'copyCode';
                    copyLink.innerHTML = 'Copy code';
                    Galleries.attachEventHandler(copyLink, 'click', function (e) {
                        clipboardData.setData("Text", htmlDecode(labelElems[scriptBlock.activeTab].code));
                        return false;
                    });
                    scriptBlock.insertBefore(copyLink, scriptBlock.childNodes[0]);
                }
            }
        });
    }

    Galleries.onWindowLoad(function(){
        initializePage();
    });

</script>
<div id="longDesc">
    
<div id="mainSection">
<p>Tracedrv is a sample driver instrumented for software tracing. The driver does not control any hardware; it simply generates trace messages. It is designed to show how to use WPP software tracing macros in a driver.
</p>
<p>Tracedrv initializes tracing (by using WPP_INIT_TRACING) and, when it receives a DeviceIOControl call, it starts a thread that logs 100 trace messages. The WPP software tracing directives, calls, and macros in the code are accompanied by comments that explain
 their purpose</p>
<p>While examining Tracedrv, read the <a href="http://msdn.microsoft.com/en-us/library/windows/hardware/ff556204">
WPP Software Tracing</a> in the Windows Driver Kit (WDK). This section includes a reference section that describes the directives, macros, and calls required for WPP software tracing.
</p>
<p class="note"><b>Note</b>&nbsp;&nbsp;To build this sample, you need Microsoft Visual Studio&nbsp;2013 and Windows Driver Kit (WDK)&nbsp;8.1. You can get evaluation copies at
<a href="http://go.microsoft.com/fwlink/?LinkID=309150">Visual Studio&nbsp;2013</a> and
<a href="http://go.microsoft.com/fwlink/?LinkID=309150">WDK&nbsp;8.1</a>. For Windows Driver Kit (WDK)&nbsp;8 samples, download the
<a href="http://code.msdn.microsoft.com/windowshardware/Tracedrv-f1c8ada8/ http://go.microsoft.com/fwlink/?LinkId=317090">WDK&nbsp;8 samples pack</a>. The samples in the WDK&nbsp;8 samples pack will build only on Microsoft Visual Studio Professional&nbsp;2012 or Microsoft Visual Studio Ultimate&nbsp;2012 with the WDK&nbsp;8.</p>
<h3>Operating system requirements</h3>
<table>
<tbody>
<tr>
<th>Client</th>
<td><dt>Windows&nbsp;8 </dt></td>
</tr>
<tr>
<th>Server</th>
<td><dt>Windows Server&nbsp;2012 </dt></td>
</tr>
</tbody>
</table>
<h3>Build the sample</h3>
<ol>
<li>Start Visual Studio&nbsp;2013. </li><li>In the <b>File</b> menu, select <b>Open</b> and chose <b>Project/Solution...</b>
</li><li>Navigate to the directory that contains the sample driver source code and select the solution file (tracedrv.sln).
</li><li>Build the sample from the <b>Build</b> menu by selecting <b>Build Solution</b>. For more about building sample solutions, see
<a href="http://msdn.microsoft.com/en-us/library/windows/hardware/">Building a Driver</a> in the WDK documentation.
</li></ol>
<h3>Run the sample</h3>
<p>To test the Tracedrv event tracing provider, use the following procedure.</p>
<ol>
<li>Copy the Tracectl.exe file that was created when you built the Tracedrv solution from the Tracectl directory (for example,\Documents\Visual Studio 11\Projects\tracedrv\tracectl\<i>platform</i>) to the Tracedrv directory (for example, \Documents\Visual Studio
 11\Projects\tracedrv\tracedrv\<i>platform</i>). </li><li>
<p>Use Tracepdb to create a trace message format (TMF) file and a trace message control (TMC) file from the Tracedrv.pdb file. Tracepdb is located in the \Program Files\Windows Kits\8.0\bin\<i>platform</i> directory. The PDB file that is used in this command
 is created when you the build the solution. Open a Visual Studio Command prompt window and navigate to the \tools\tracing\<i>platform</i> subdirectory. Type the following command:
</p>
<p><b>tracepdb -f </b><i>path</i><b>\tracedrv.pdb</b> </p>
</li><li>
<p>Create a control GUID file for Tracedrv by opening a text file, adding the following content, and saving the file as Tracedrv.ctl.
</p>
<div class="code"><span>
<table>
<tbody>
<tr>
<th></th>
</tr>
<tr>
<td>
<pre>CtlGuid d58c126f-b309-11d1-969e-0000f875a5bc
</pre>
</td>
</tr>
</tbody>
</table>
</span></div>
</li><li>
<p>Use Tracelog to start a trace session that is called &quot;TestTracedrv&quot;. Tracelog is located in the \Program Files\Windows Kits\8.0\Tools\Tracing\<i>platform</i> directory. The Tracedrv.ctl file that is used in this command was created in the previous step.
 The following command starts a trace session and creates a trace log file, tracedrv.etl, in the local directory.</p>
<pre class="syntax"><code>tracelog -start TestTracedrv -guid tracedrv.ctl -f tracedrv.etl -flag 1</code></pre>
<p class="note"><b>Note</b>&nbsp;&nbsp;Note: Without the -flag parameter, Tracedrv will not generate any trace messages.</p>
</li><li>To generate trace messages, run Tracectl.exe. This executable file is built when you build the solution. Each time you type a character, other than Q or q, Tracectl sends an IOCTL to the driver that signals it to generate trace messages. To stop Tracectl,
 type <b>Q</b> or <b>q</b>. </li><li>
<p>To stop the trace session, use the following Tracelog command.</p>
<pre class="syntax"><code>tracelog -stop TestTracedrv
</code></pre>
</li><li>
<p>To display the trace messages in the Tracedrv.etl file, use Tracefmt. Tracefmt is located in the \Program Files\Windows Kits\8.0\Tools\Tracing\<i>platform</i>. The TMF file used in this command was created by Tracepdb in step 2. Type the following command:
</p>
<pre class="syntax"><code>tracefmt tracedrv.etl -p &lt;Path to TMF file&gt; -o Tracedrv.out</code></pre>
</li></ol>
<p>The resulting Tracedrv.out file is a human-readable text file of the Tracedrv trace messages. To interpret the trace messages, in the Tracedrv.c file, search for the DoTraceMessage macros.</p>
<h3><a id="Notes"></a><a id="notes"></a><a id="NOTES"></a>Notes</h3>
<p>This sample driver should not be used in a production environment. </p>
<p>Tracedrv is designed for Windows XP and later versions of Windows. It does not demonstrate how to add WPP software tracing to a Windows 2000 driver. (For information about adding WPP software tracing to a Windows 2000 driver, see the Tracing FAQ topic in
 the Windows DDK documentation.)</p>
<p>Also, because it is not a Plug and Play driver, Tracedrv does not demonstrate tracing in a Plug and Play environment.
</p>
<p>Tracedrv demonstrates the basic elements required for software tracing. It does not demonstrate more advanced tracing techniques, such as writing customized tracing calls (variations of DoTraceMessage), or the use of WMI calls for software tracing.
</p>
</div>

</div>


    </div>
</body>
</html>
